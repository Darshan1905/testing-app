import 'dart:convert';

import 'package:occusearch/constants/constants.dart';
import 'package:occusearch/data_provider/sqflite_database/entity/config_table.dart';
import 'package:occusearch/data_provider/sqflite_database/sqflite_database_constants.dart';
import 'package:occusearch/features/point_test/point_test_model/point_test_ques_model.dart';

class PointTestRepository {
  static Future<BaseResponseModel> callAPIToSavePointTest(
      BuildContext context, requestParam) async {
    String url = FirebaseRemoteConfigController
        .shared.dynamicEndUrl!.pointTest!.savePointTestUrl!;
    BaseResponseModel response = await APIProvider.post(url,
        parameters: requestParam,
        dioOptions:
            DioOptions(encryptionType: EncryptionType.kondeskEncryption));
    return response;
  }

  static insertPointTestQuestionListInDb(
      String strPointTestQuestionListJson) async {
    var configTable = await ConfigTable.read(
        strField: ConfigFields.pointTestQuestionListSyncDate);

    //If user is visiting point test page for first time, then all questions will be inserted.
    // Otherwise existing values for question list in database will be updated.
    if (configTable == null) {
      var configPointTestQuestionTable = ConfigTable(
          fieldName: ConfigFields.pointTestQuestionList,
          fieldValue: strPointTestQuestionListJson);

      await ConfigTable.insertTable(configPointTestQuestionTable.toJson());

      var configPointTestSyncDateTable = ConfigTable(
          fieldName: ConfigFields.pointTestQuestionListSyncDate,
          fieldValue: Utility.getTodayDate());

      await ConfigTable.insertTable(configPointTestSyncDateTable.toJson());
    } else {
      await ConfigTable.update(
          strFieldValue: strPointTestQuestionListJson,
          strFieldName: ConfigFields.pointTestQuestionList);

      await ConfigTable.update(
          strFieldValue: Utility.getTodayDate(),
          strFieldName: ConfigFields.pointTestQuestionListSyncDate);
    }
  }

  static Future<PointTestQuestionModelData?>
      getPointTestQuestionListFromDb() async {
    //final configDao = dbUtil!.configDao;
    var configTable =
        await ConfigTable.read(strField: ConfigFields.pointTestQuestionList);
    // String temp = '{"calculatortype":"gsmlist","sourceurl":"https://immi.homeaffairs.gov.au/help-support/tools/points-calculator","minimumreqpoint":"65","totalpoint":"165","questionlist":[{"id":1,"qname":"Which visa Subclass are you applying for?","qtype":"Visa Subclass","priority":1,"option":[{"oid":1,"oname":"Skilled Independent Visa Subclass 189 ( Occupation should be listed in the Medium and Long term Strategic Skill List MLTSSL)","ovalue":"0","displayquestion":[]},{"oid":2,"oname":"Skilled Nominated Visa Subclass 190 ( Occupation should be listed in the Short-term Skilled Occupation List STSOL)","ovalue":"0","displayquestion":[{"qid":3}]},{"oid":3,"oname":"Skilled Work Regional (Provisional) Visa Subclass 491 ( Requires a nomination by the designated area from State or Territory or by a Family Member staying in the Designated area)","ovalue":"0","displayquestion":[{"qid":4}]}]},{"id":2,"qname":"Which age band do you fit into?","qtype":"Age","priority":4,"option":[{"oid":1,"oname":"18 to 24","ovalue":"25","displayquestion":[]},{"oid":2,"oname":"25 to 32","ovalue":"30","displayquestion":[]},{"oid":3,"oname":"33 to 39","ovalue":"25","displayquestion":[]},{"oid":4,"oname":"40 to 44","ovalue":"15","displayquestion":[]}]},{"id":3,"qname":"Have you been invited to apply for a Skilled Nominated visa (subclass 190) and the nominating State or Territory government agency has not withdrawn the nomination?","qtype":"Nomination","priority":2,"option":[{"oid":1,"oname":"Yes","ovalue":"05","displayquestion":[]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]},{"id":4,"qname":"Have you been nominated or sponsored to apply for this visa?","qtype":"Nomination or Sponsorship","priority":3,"option":[{"oid":1,"oname":"You were invited to apply for a Skilled Work Regional (Provisional) visa (subclass 491) because you were nominated and the nominating State or Territory government agency has not withdrawn that nomination","ovalue":"15","displayquestion":[]},{"oid":2,"oname":"You are being sponsored for a Skilled Work Regional (Provisional) visa (subclass 491) visa by a family member and the Minister has accepted that sponsorship","ovalue":"15","displayquestion":[]},{"oid":3,"oname":"Not applicable","ovalue":"00","displayquestion":[]}]},{"id":5,"qname":"What is your highest Qualification?","qtype":"Qualifications","priority":5,"option":[{"oid":1,"oname":"A Doctorate Degree (PHD) holder from an Australian institute or from another Recognized institute","ovalue":"20","displayquestion":[]},{"oid":2,"oname":"A Bachelor Degree holder from an Australian institute or from another Recognized institute","ovalue":"15","displayquestion":[]},{"oid":3,"oname":"A Diploma or trade qualification completed in Australia or an award or qualification awarded by relevant skill assessing authority","ovalue":"10","displayquestion":[]},{"oid":4,"oname":"No Recognised Qualifications","ovalue":"00","displayquestion":[]}]},{"id":6,"qname":"Do you have at least 1 Degree, Diploma or Trade qualification which was for at least 2 years (minimum 92 weeks CRICOS registered) from an Australian institute?","qtype":"Australian Educational Qualification","priority":6,"option":[{"oid":1,"oname":"Yes","ovalue":"05","displayquestion":[{"qid":7},{"qid":8}]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]},{"id":7,"qname":"Did you live and study in a regional and low population growth metropolitan area of Australia and complete a course which meets the Australian study requirement at the time of invitation to apply for the visa?","qtype":"Regional Study and Stay","priority":7,"option":[{"oid":1,"oname":"Yes","ovalue":"05","displayquestion":[]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]},{"id":8,"qname":"Do you have a Masters degree by research or a Doctorate degree from an Australian educational institution that included at least 2 academic years to in a relevant field?","qtype":"Specialist Education Qualification ","priority":8,"option":[{"oid":1,"oname":"Yes","ovalue":"10","displayquestion":[]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]},{"id":9,"qname":"How long have you been working in your nominated occupation in the past 10 years; as a Full Time employee, working at least 20 hours per week?","qtype":"Work Experience - Outside Australia","priority":9,"option":[{"oid":1,"oname":"8 Years or More","ovalue":"15","displayquestion":[]},{"oid":2,"oname":"5 Years or More","ovalue":"10","displayquestion":[]},{"oid":3,"oname":"3 Years or More","ovalue":"05","displayquestion":[]},{"oid":4,"oname":"Less than 3 years/No Experience","ovalue":"00","displayquestion":[]}]},{"id":10,"qname":"How long have you worked in your nominated or closely nominated occupation in the past 10 years; as a Full Time employee, working at least 20 hours per week?","qtype":"Work Experience - Within Australia","priority":10,"option":[{"oid":1,"oname":"8 Years or More","ovalue":"20","displayquestion":[]},{"oid":2,"oname":"5 Years or More","ovalue":"15","displayquestion":[]},{"oid":3,"oname":"3 Years or More","ovalue":"10","displayquestion":[]},{"oid":4,"oname":"1 Years or More","ovalue":"05","displayquestion":[]},{"oid":5,"oname":"No Experience","ovalue":"00","displayquestion":[]}]},{"id":11,"qname":"How would you rate your English language ability?","qtype":"English Language Ability","priority":11,"option":[{"oid":1,"oname":"Competent English","ovalue":"00","displayquestion":[]},{"oid":2,"oname":"Proficient English","ovalue":"10","displayquestion":[]},{"oid":3,"oname":"Superior English","ovalue":"20","displayquestion":[]}]},{"id":12,"qname":"Do you have a Spouse or Partner and want to claim Partner skill point? Do they meet any one of these criteria?","qtype":"Partner Skills Point","priority":12,"option":[{"oid":1,"oname":"Your spouse or de facto partner must also be an applicant for this visa and meet age, English and skill criteria","ovalue":"10","displayquestion":[]},{"oid":2,"oname":"Your spouse or de facto partner must also be an applicant for this visa and has competent English","ovalue":"05","displayquestion":[]},{"oid":3,"oname":"You are single or your partner is an Australian citizen or permanent resident","ovalue":"10","displayquestion":[]},{"oid":4,"oname":"Not Applicable","ovalue":"00","displayquestion":[]}]},{"id":13,"qname":"Have you been accredited at the paraprofessional level or above for interpreting or translating in a language that are offered accreditation in by the National Accreditation Authority for Translator and Interpreters (NAATI)?","qtype":"Accredited Community Language","priority":13,"option":[{"oid":1,"oname":"Yes","ovalue":"05","displayquestion":[]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]},{"id":14,"qname":"Have you completed your professional year program in Australia in past 48 months?","qtype":"Professional Year Program in Australia","priority":14,"option":[{"oid":1,"oname":"Yes","ovalue":"05","displayquestion":[]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]}]}';
    // String temp = '{"flag":true,"message":"Success","data":[{"calculatortype":"gsmlist","sourceurl":"https://immi.homeaffairs.gov.au/help-support/tools/points-calculator","minimumreqpoint":"65","totalpoint":"165","questionlist":[{"id":1,"qname":"Which visa Subclass are you applying for?","qtype":"Visa Subclass","priority":1,"option":[{"oid":1,"oname":"Skilled Independent Visa Subclass 189 ( Occupation should be listed in the Medium and Long term Strategic Skill List MLTSSL)","ovalue":"0","displayquestion":[]},{"oid":2,"oname":"Skilled Nominated Visa Subclass 190 ( Occupation should be listed in the Short-term Skilled Occupation List STSOL)","ovalue":"0","displayquestion":[{"qid":3}]},{"oid":3,"oname":"Skilled Work Regional (Provisional) Visa Subclass 491 ( Requires a nomination by the designated area from State or Territory or by a Family Member staying in the Designated area)","ovalue":"0","displayquestion":[{"qid":4}]}]},{"id":2,"qname":"Which age band do you fit into?","qtype":"Age","priority":4,"option":[{"oid":1,"oname":"18 to 24","ovalue":"25","displayquestion":[]},{"oid":2,"oname":"25 to 32","ovalue":"30","displayquestion":[]},{"oid":3,"oname":"33 to 39","ovalue":"25","displayquestion":[]},{"oid":4,"oname":"40 to 44","ovalue":"15","displayquestion":[]}]},{"id":3,"qname":"Have you been invited to apply for a Skilled Nominated visa (subclass 190) and the nominating State or Territory government agency has not withdrawn the nomination?","qtype":"Nomination","priority":2,"option":[{"oid":1,"oname":"Yes","ovalue":"05","displayquestion":[]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]},{"id":4,"qname":"Have you been nominated or sponsored to apply for this visa?","qtype":"Nomination or Sponsorship","priority":3,"option":[{"oid":1,"oname":"You were invited to apply for a Skilled Work Regional (Provisional) visa (subclass 491) because you were nominated and the nominating State or Territory government agency has not withdrawn that nomination","ovalue":"15","displayquestion":[]},{"oid":2,"oname":"You are being sponsored for a Skilled Work Regional (Provisional) visa (subclass 491) visa by a family member and the Minister has accepted that sponsorship","ovalue":"15","displayquestion":[]},{"oid":3,"oname":"Not applicable","ovalue":"00","displayquestion":[]}]},{"id":5,"qname":"What is your highest Qualification?","qtype":"Qualifications","priority":5,"option":[{"oid":1,"oname":"A Doctorate Degree (PHD) holder from an Australian institute or from another Recognized institute","ovalue":"20","displayquestion":[]},{"oid":2,"oname":"A Bachelor Degree holder from an Australian institute or from another Recognized institute","ovalue":"15","displayquestion":[]},{"oid":3,"oname":"A Diploma or trade qualification completed in Australia or an award or qualification awarded by relevant skill assessing authority","ovalue":"10","displayquestion":[]},{"oid":4,"oname":"No Recognised Qualifications","ovalue":"00","displayquestion":[]}]},{"id":6,"qname":"Do you have at least 1 Degree, Diploma or Trade qualification which was for at least 2 years (minimum 92 weeks CRICOS registered) from an Australian institute?","qtype":"Australian Educational Qualification","priority":6,"option":[{"oid":1,"oname":"Yes","ovalue":"05","displayquestion":[{"qid":7},{"qid":8}]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]},{"id":7,"qname":"Did you live and study in a regional and low population growth metropolitan area of Australia and complete a course which meets the Australian study requirement at the time of invitation to apply for the visa?","qtype":"Regional Study and Stay","priority":7,"option":[{"oid":1,"oname":"Yes","ovalue":"05","displayquestion":[]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]},{"id":8,"qname":"Do you have a Masters degree by research or a Doctorate degree from an Australian educational institution that included at least 2 academic years to in a relevant field?","qtype":"Specialist Education Qualification ","priority":8,"option":[{"oid":1,"oname":"Yes","ovalue":"10","displayquestion":[]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]},{"id":9,"qname":"How long have you been working in your nominated occupation in the past 10 years; as a Full Time employee, working at least 20 hours per week?","qtype":"Work Experience - Outside Australia","priority":9,"option":[{"oid":1,"oname":"8 Years or More","ovalue":"15","displayquestion":[]},{"oid":2,"oname":"5 Years or More","ovalue":"10","displayquestion":[]},{"oid":3,"oname":"3 Years or More","ovalue":"05","displayquestion":[]},{"oid":4,"oname":"Less than 3 years/No Experience","ovalue":"00","displayquestion":[]}]},{"id":10,"qname":"How long have you worked in your nominated or closely nominated occupation in the past 10 years; as a Full Time employee, working at least 20 hours per week?","qtype":"Work Experience - Within Australia","priority":10,"option":[{"oid":1,"oname":"8 Years or More","ovalue":"20","displayquestion":[]},{"oid":2,"oname":"5 Years or More","ovalue":"15","displayquestion":[]},{"oid":3,"oname":"3 Years or More","ovalue":"10","displayquestion":[]},{"oid":4,"oname":"1 Years or More","ovalue":"05","displayquestion":[]},{"oid":5,"oname":"No Experience","ovalue":"00","displayquestion":[]}]},{"id":11,"qname":"How would you rate your English language ability?","qtype":"English Language Ability","priority":11,"option":[{"oid":1,"oname":"Competent English","ovalue":"00","displayquestion":[]},{"oid":2,"oname":"Proficient English","ovalue":"10","displayquestion":[]},{"oid":3,"oname":"Superior English","ovalue":"20","displayquestion":[]}]},{"id":12,"qname":"Do you have a Spouse or Partner and want to claim Partner skill point? Do they meet any one of these criteria?","qtype":"Partner Skills Point","priority":12,"option":[{"oid":1,"oname":"Your spouse or de facto partner must also be an applicant for this visa and meet age, English and skill criteria","ovalue":"10","displayquestion":[]},{"oid":2,"oname":"Your spouse or de facto partner must also be an applicant for this visa and has competent English","ovalue":"05","displayquestion":[]},{"oid":3,"oname":"You are single or your partner is an Australian citizen or permanent resident","ovalue":"10","displayquestion":[]},{"oid":4,"oname":"Not Applicable","ovalue":"00","displayquestion":[]}]},{"id":13,"qname":"Have you been accredited at the paraprofessional level or above for interpreting or translating in a language that are offered accreditation in by the National Accreditation Authority for Translator and Interpreters (NAATI)?","qtype":"Accredited Community Language","priority":13,"option":[{"oid":1,"oname":"Yes","ovalue":"05","displayquestion":[]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]},{"id":14,"qname":"Have you completed your professional year program in Australia in past 48 months?","qtype":"Professional Year Program in Australia","priority":14,"option":[{"oid":1,"oname":"Yes","ovalue":"05","displayquestion":[]},{"oid":2,"oname":"No","ovalue":"00","displayquestion":[]}]}]}]}';
    PointTestQuestionModelData? questionData;
    if (configTable != null && configTable.fieldValue!.isNotEmpty) {
      if (configTable.fieldValue!.contains("flag")) {
        PointTestQuesModel model = PointTestQuesModel.fromJson(
            jsonDecode(configTable.fieldValue.toString()));

        /*Map<String, dynamic> questionListData = json.decode(configTable);
        PointTestQuesModel model =
        PointTestQuesModel.fromJson(questionListData);*/
        questionData = model.data?[0];
      } else {
        //Map<String, dynamic> data = jsonDecode(configTable.fieldValue);
        questionData = PointTestQuestionModelData.fromJson(
            jsonDecode(configTable.fieldValue!));
      }
    }
    return questionData;
  }
}
